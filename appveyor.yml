branches:
  only:
    - master

image: Visual Studio 2019

environment:
  GOPATH: c:\gopath

init:
  - SET PATH=%GOPATH%\bin;%PATH%
  - git config --global core.autocrlf input
  - chcp 1252

install:
  - go version
  - go env
  - mkdir %GOPATH%
  # This is not a dependency but a test report filter...
  - set GO111MODULE=on
  - go install github.com/tischda/go2xunit

build_script:
  - go build -ldflags "all=-s -w"

test_script:
  - go test -v -cover
  - go test -v | go2xunit.exe -xunitnet > xunit-report.xml

artifacts:
  - path: gcd.exe
    name: gcd

deploy: off

on_finish:
- ps: >-
    If (Test-Path .\xunit-report.xml) {
      (New-Object 'System.Net.WebClient').UploadFile("https://ci.appveyor.com/api/testresults/xunit/$($env:APPVEYOR_JOB_ID)", (Resolve-Path .\xunit-report.xml))
    }
    